<html>
	<head>
		<meta charset="utf-8">
		<title>My First Multiplayer Game On Javascript</title>

		<style>
			#screen {
				border: 10px solid #ccc;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        image-rendering: -moz-crisp-edges;

        width: 400px;
        height: 400px;
      }
		</style>

		<body>
			<canvas id="screen" width='10' height='10'></canvas>
    </body>

    <script>
      const screen = document.getElementById('screen')
      const context = screen.getContext('2d')
      const currentPlayerId = 'player1'

      function createGame() {
        const state = {
          players: {
            'player1': {x: 1, y: 1},
            'player2': {x: 4, y: 1},
          },
          fruits: {
            'fruit1': {x: 1, y: 4}
          }
        }

        function movePlayer(command) {
          const {playerId, keyPressed} = command
          const player = state.players[playerId]

          console.log(playerId, keyPressed)

          if (keyPressed === 'ArrowUp' && player.y -1 >= 0) {
            player.y -= 1
            return;
          }

          if (keyPressed === 'ArrowDown' && player.y + 1 < screen.height) {
            player.y += 1
            return;
          }

          if (keyPressed === 'ArrowLeft' && player.x - 1 >= 0) {
            player.x -= 1
            return;
          }

          if (keyPressed === 'ArrowRight' && player.x + 1 < screen.width) {
            player.x += 1
            return;
          }
        }

        return {
          state,
          movePlayer
        }
      }

      const game = createGame()

      document.addEventListener('keydown', handleKeyDown)

      function handleKeyDown(event) {
        const keyPressed = event.key

        const command = {
          playerId: currentPlayerId,
          keyPressed
        }

        game.movePlayer(command)
      }

      renderScreen()

      function renderScreen() {
        context.fillStyle = 'white'
        context.clearRect(0, 0, 10, 10)

        const {players, fruits} = game.state;

        for (const playerId in players) {
          const player = players[playerId]

          context.fillStyle = 'black'
          context.fillRect(player.x, player.y, 1, 1)
        }

        for (const fruitId in fruits) {
          const fruit = fruits[fruitId]

          context.fillStyle = 'green'
          context.fillRect(fruit.x, fruit.y, 1, 1)
        }

        requestAnimationFrame(renderScreen)
      }
    </script>
	</head>
</html>
